# Create database
CREATE DATABASE IF NOT EXISTS NY_COLLISION;

set hive.cli.print.header=true;

# Create table
CREATE EXTERNAL TABLE IF NOT EXISTS NY_COLLISION.CRASH_Ext(
    COLLISION_ID string,
    ACCIDENT_DATE string,
    ACCIDENT_TIME string,
    BOROUGH string,
    ZIPCODE integer,
    LATITUDE double,
    LONGITUDE double,
    LATLONG string,
    ON_STREET_NAME string,
    CROSS_STREET_NAME string,
    OFF_STREET_NAME string,
    NUMBER_OF_PERSONS_INJURED string,
    NUMBER_OF_PERSONS_KILLED string,
    NUMBER_OF_PEDESTRIANS_INJURED string,
    NUMBER_OF_PEDESTRIANS_KILLED string,
    NUMBER_OF_CYCLIST_INJURED string,
    NUMBER_OF_CYCLIST_KILLED string,
    NUMBER_OF_MOTORIST_INJURED string,
    NUMBER_OF_MOTORIST_KILLED string,
    CONTRIBUTING_FACTOR_VEHICLE_1 string,
    CONTRIBUTING_FACTOR_VEHICLE_2 string,
    CONTRIBUTING_FACTOR_VEHICLE_3 string,
    CONTRIBUTING_FACTOR_VEHICLE_4 string,
    CONTRIBUTING_FACTOR_VEHICLE_5 string,
    VEHICLE_TYPE_CODE_1 string,
    VEHICLE_TYPE_CODE_2 string,
    VEHICLE_TYPE_CODE_3 string,
    VEHICLE_TYPE_CODE_4 string,
    VEHICLE_TYPE_CODE_5 string)
    ROW FORMAT DELIMITED
    FIELDS TERMINATED BY ','
    LOCATION '/user/crash_ext';

# Load data
LOAD DATA LOCAL INPATH 'sample-data-l2-e1.csv' OVERWRITE INTO TABLE NY_COLLISION.CRASH;

# Hive CTAS
CREATE TABLE NY_COLLISION.CRASH_parquet STORED AS PARQUET LOCATION '/user/crash_parquet' AS SELECT * FROM NY_COLLISION.CRASH;

SELECT * FROM NY_COLLISION.CRASH LIMIT 10;
SELECT * FROM NY_COLLISION.CRASH_parquet LIMIT 10;

# Check file sizes
hdfs dfs -ls -h /user/crash_parquet